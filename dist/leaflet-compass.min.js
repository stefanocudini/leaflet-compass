/* 
 * Leaflet Control Compass v1.5.3 - 2018-11-23 
 * 
 * Copyright 2014 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * https://opengeo.tech/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demos: 
 * https://opengeo.tech/maps/leaflet-compass/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-compass.git 
 * 
 */
!function(a){if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)module.exports=a(require("leaflet"));else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";a(window.L)}}(function(a){return a.Control.Compass=a.Control.extend({includes:"1"==a.version[0]?a.Evented.prototype:a.Mixin.Events,options:{position:"topright",autoActive:!1,showDigit:!1,textErr:"",callErr:null,angleOffset:2},initialize:function(b){b&&b.style&&(b.style=a.Util.extend({},this.options.style,b.style)),a.Util.setOptions(this,b),this._errorFunc=this.options.callErr||this.showAlert,this._isActive=!1,this._currentAngle=null},onAdd:function(b){var c=this;this._map=b;var d=a.DomUtil.create("div","leaflet-compass");return this._button=a.DomUtil.create("span","compass-button",d),this._button.href="#",this._icon=a.DomUtil.create("div","compass-icon",this._button),this._digit=a.DomUtil.create("span","compass-digit",this._button),this._alert=a.DomUtil.create("div","compass-alert",d),this._alert.style.display="none",a.DomEvent.on(this._button,"click",a.DomEvent.stop,this).on(this._button,"click",this._switchCompass,this),a.DomEvent.on(window,"compassneedscalibration",function(a){c.showAlert("Your compass needs calibrating! Wave your device in a figure-eight motion")},this),this.options.autoActive&&this.activate(),d},onRemove:function(b){this.deactivate(),a.DomEvent.off(this._button,"click",a.DomEvent.stop,this).off(this._button,"click",this._switchCompass,this)},_switchCompass:function(){this._isActive?this.deactivate():this.activate()},_rotateHandler:function(a){var b,c=this;return this._isActive?(a.webkitCompassHeading?b=360-a.webkitCompassHeading:a.alpha?b=a.alpha:this._errorCompass({message:"Orientation angle not found"}),b=Math.round(b),void(b%this.options.angleOffset===0&&c.setAngle(b))):!1},_errorCompass:function(a){this.deactivate(),this._errorFunc.call(this,this.options.textErr||a.message)},_rotateElement:function(a){a.style.webkitTransform="rotate("+this._currentAngle+"deg)",a.style.MozTransform="rotate("+this._currentAngle+"deg)",a.style.transform="rotate("+this._currentAngle+"deg)"},setAngle:function(a){this.options.showDigit&&!isNaN(parseFloat(a))&&isFinite(a)&&(this._digit.innerHTML=a+"Â°"),this._currentAngle=a,this._rotateElement(this._icon),this.fire("compass:rotated",{angle:a})},getAngle:function(){return this._currentAngle},activate:function(){this._isActive=!0,a.DomEvent.on(window,"deviceorientation",this._rotateHandler,this),a.DomUtil.addClass(this._button,"active")},deactivate:function(){this.setAngle(0),this._isActive=!1,a.DomEvent.off(window,"deviceorientation",this._rotateHandler,this),a.DomUtil.removeClass(this._button,"active"),this.fire("compass:disabled")},showAlert:function(a){this._alert.style.display="block",this._alert.innerHTML=a;var b=this;clearTimeout(this.timerAlert),this.timerAlert=setTimeout(function(){b._alert.style.display="none"},5e3)}}),a.control.compass=function(b){return new a.Control.Compass(b)},a.Control.Compass});